"0","set.seed(123)"
"0","solarAU <- read_csv("
"0","  file=""solarAU.csv"", "
"0","  col_types = cols("
"0","    X1=col_integer(),"
"0","    prod=col_double(),"
"0","    toy=col_double(),"
"0","    tod=col_double()"
"0","  ))"
"0","# Work with log production, since it's less skewed"
"0","solarAU$logprod <- log(solarAU$prod+0.01)  # +0.01 to avoid -Inf when production is 0"
"0",""
"0","X <- with(solarAU, cbind(1, tod, tod^2, toy, toy^2))"
"0","y <- solarAU$logprod"
"0","colnames(X) <- c(""intercept"", ""tod"", ""todsq"", ""toy"", ""toysq"")"
"0",""
"0","lmLocal <- function(y, x0, X0, x, X, H){"
"0","  w <- dmvnorm(x, x0, H)"
"0","  fit <- lm(y ~ -1 + X, weights = w)"
"0","  return( t(X0) %*% coef(fit) )"
"0","}"
"0","set.seed(123)"
"0","n <- nrow(X)"
"0","nsub <- 2e3"
"0","sub <- sample(1:n, nsub, replace = FALSE)"
"0",""
"0","y <- solarAU$logprod"
"0","solarAU_sub <- solarAU[sub, ]"
"0","x <- as.matrix(solarAU[c(""tod"", ""toy"")])"
"0","x0 <- x[sub, ]"
"0","X0 <- X[sub, ]"
"0","predLocal <- sapply(1:nsub, function(ii){"
"0","  lmLocal(y = y, x0 = x0[ii, ], X0 = X0[ii, ], x = x, X = X, H = diag(c(1, 0.1)^2))"
"0","})"
